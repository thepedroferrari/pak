---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import InstructorsAnimation from '@/components/InstructorsAnimation.astro';
import { t } from '@/i18n/ui';

const lang = 'en';

export async function getStaticPaths() {
  const instructors = await getCollection('instructors');
  return instructors.map((instructor) => ({
    params: { slug: instructor.id },
    props: { instructor },
  }));
}

const { instructor } = Astro.props;
const { name, title_en, rank_en, bio_en, location_en, image, tier, chinese_rank, gallery } = instructor.data;

// Tier-based accent colors
const tierAccent = {
  grandmaster: { border: 'border-gold/30', text: 'text-gold', bg: 'bg-gold/10', badge: 'bg-gold/20 text-gold' },
  founder: { border: 'border-red-primary/30', text: 'text-red-light', bg: 'bg-red-primary/10', badge: 'bg-red-primary/20 text-red-light' },
  master: { border: 'border-red-primary/20', text: 'text-red-light', bg: 'bg-red-primary/8', badge: 'bg-red-primary/15 text-red-light' },
  sifu: { border: 'border-white/15', text: 'text-gray-light', bg: 'bg-white/5', badge: 'bg-white/8 text-gray-light/70' },
  sipak: { border: 'border-white/10', text: 'text-gray-light/70', bg: 'bg-white/3', badge: 'bg-white/5 text-gray-light/50' },
}[tier];
---

<BaseLayout
  title={`${name} — ${title_en}`}
  description={bio_en || `${name}, ${title_en} at the Pak Shao Lin Association.`}
  lang={lang}
>
  <!-- Dark background wrapper -->
  <div class="detail-dark-bg min-h-screen">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12 sm:py-16">

      <!-- Back navigation -->
      <a href="/en/instructors/" class="inline-flex items-center gap-2 text-gold/60 hover:text-gold transition-colors text-sm mb-10">
        <span aria-hidden="true">&larr;</span>
        {t(lang, 'instructors.backToList')}
      </a>

      <!-- Hero: Photo + Name/Rank -->
      <div class="text-center mb-12 sm:mb-16">
        <!-- Chinese rank watermark -->
        <div class="font-chinese text-gold/8 text-6xl sm:text-7xl mb-6 tracking-[0.3em]" aria-hidden="true">{chinese_rank}</div>

        <!-- Large photo -->
        <div class="relative inline-block mb-8">
          <div class:list={['w-48 h-48 sm:w-56 sm:h-56 rounded-2xl overflow-hidden border-2 shadow-2xl mx-auto', tierAccent.border]} data-gsap="detail-photo">
            {image ? (
              <img src={image} alt={name} class="w-full h-full object-cover" />
            ) : (
              <div class="w-full h-full flex items-center justify-center bg-white/5">
                <span class="text-6xl text-gray-light/20 font-bold">{name.charAt(0)}</span>
              </div>
            )}
          </div>
        </div>

        <!-- Rank badge -->
        <div class="mb-3">
          <span class:list={['inline-block px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider', tierAccent.badge]}>
            <span class="font-chinese mr-1.5">{chinese_rank}</span>
            {title_en}
          </span>
        </div>

        <!-- Name -->
        <h1 class="text-4xl sm:text-5xl font-black text-white">{name}</h1>
        <p class="text-gold/60 font-medium uppercase tracking-wider mt-2">{rank_en}</p>

        <!-- Location -->
        <div class="flex items-center justify-center gap-2 mt-4 text-sm text-gray-light/50">
          <span class="w-1.5 h-1.5 bg-red-primary rounded-full"></span>
          {location_en}
        </div>

        <!-- Gold divider -->
        <div class="flex items-center justify-center gap-3 max-w-xs mx-auto mt-8">
          <div class="h-px flex-1 bg-gradient-to-r from-transparent to-gold/30"></div>
          <div class="w-2 h-2 rotate-45 border border-gold/40"></div>
          <div class="h-px flex-1 bg-gradient-to-l from-transparent to-gold/30"></div>
        </div>
      </div>

      <!-- Biography Panel -->
      {bio_en && (
        <div class="relative bg-white/[0.03] border border-white/8 rounded-2xl p-8 sm:p-10 mb-12 sm:mb-16" data-gsap="bio-panel">
          <!-- Corner ornaments -->
          <div class="absolute top-3 left-3 w-5 h-5 border-t-2 border-l-2 border-gold/25 hidden sm:block"></div>
          <div class="absolute top-3 right-3 w-5 h-5 border-t-2 border-r-2 border-gold/25 hidden sm:block"></div>
          <div class="absolute bottom-3 left-3 w-5 h-5 border-b-2 border-l-2 border-gold/25 hidden sm:block"></div>
          <div class="absolute bottom-3 right-3 w-5 h-5 border-b-2 border-r-2 border-gold/25 hidden sm:block"></div>

          <h2 class="text-lg font-bold text-gold mb-4">{t(lang, 'instructors.biography')}</h2>
          <p class="text-gray-light/60 leading-relaxed text-lg">{bio_en}</p>
        </div>
      )}

      <!-- Photo Gallery (conditional) -->
      {gallery && gallery.length > 0 && (
        <div class="mb-12 sm:mb-16">
          <h2 class="text-lg font-bold text-gold mb-6">{t(lang, 'instructors.gallery')}</h2>
          <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4" data-gsap="gallery-grid">
            {gallery.map((photo) => (
              <div class="aspect-square rounded-xl overflow-hidden border border-white/8 hover:border-gold/25 transition-all group" data-gsap="gallery-item">
                <img
                  src={photo}
                  alt={`${name} — photo`}
                  class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                  loading="lazy"
                />
              </div>
            ))}
          </div>
        </div>
      )}

      <!-- Back link (bottom) -->
      <div class="text-center pt-8 border-t border-white/5">
        <a href="/en/instructors/" class="inline-flex items-center gap-2 text-gold/60 hover:text-gold transition-colors text-sm">
          <span aria-hidden="true">&larr;</span>
          {t(lang, 'instructors.backToList')}
        </a>
      </div>

    </div>
  </div>

  <InstructorsAnimation />
</BaseLayout>

<style>
  .detail-dark-bg {
    background-color: #0a0a0a;
    background-image:
      radial-gradient(ellipse at 50% 0%, rgba(139, 0, 0, 0.1), transparent 50%),
      radial-gradient(ellipse at 50% 100%, rgba(212, 175, 55, 0.04), transparent 50%),
      repeating-linear-gradient(45deg, transparent, transparent 39px, rgba(212, 175, 55, 0.015) 39px, rgba(212, 175, 55, 0.015) 40px),
      repeating-linear-gradient(-45deg, transparent, transparent 39px, rgba(212, 175, 55, 0.015) 39px, rgba(212, 175, 55, 0.015) 40px);
  }
</style>
