---
// Script-only component — renders no HTML, just client-side animation logic.
// Imported at the bottom of homepage to layer GSAP animations on top of static content.
---

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

    // ─── Hero: staggered entrance + Chinese watermark fire glow ───
    gsap.set('[data-gsap="hero-zh"]', { opacity: 0, scale: 0.8 });
    gsap.set('[data-gsap="hero-glow"]', { opacity: 0, scale: 0.4 });
    gsap.set('[data-gsap="hero-line"]', { opacity: 0, y: -20 });
    gsap.set('[data-gsap="hero-title"]', { opacity: 0, y: 30 });
    gsap.set('[data-gsap="hero-subtitle"]', { opacity: 0, y: 20 });
    gsap.set('[data-gsap="hero-desc"]', { opacity: 0, y: 20 });
    gsap.set('[data-gsap="hero-ctas"]', { opacity: 0, y: 20 });

    const heroTl = gsap.timeline({ delay: 0.2 });

    // Chinese watermark fire glow reveal
    heroTl
      .to('[data-gsap="hero-glow"]', { opacity: 0.7, scale: 1, duration: 1.2, ease: 'power2.out' }, 0)
      .to('[data-gsap="hero-zh"]', { opacity: 1, scale: 1, duration: 1, ease: 'power2.out' }, 0)
      .to('[data-gsap="hero-zh"]', {
        textShadow: '0 0 40px rgba(196, 30, 58, 0.6), 0 0 80px rgba(139, 0, 0, 0.4), 0 0 20px rgba(212, 175, 55, 0.5)',
        duration: 0.8,
        ease: 'power2.in',
      }, 0.3)
      .to('[data-gsap="hero-zh"]', {
        textShadow: '0 0 15px rgba(212, 175, 55, 0.2), 0 0 40px rgba(212, 175, 55, 0.06)',
        duration: 1.0,
        ease: 'power2.out',
      }, 1.1)
      .to('[data-gsap="hero-glow"]', { opacity: 0.25, duration: 1.0, ease: 'power2.out' }, 1.1);

    // Title entrance sequence
    heroTl
      .to('[data-gsap="hero-line"]', { opacity: 1, y: 0, duration: 0.6, ease: 'power2.out' }, 0.4)
      .to('[data-gsap="hero-title"]', { opacity: 1, y: 0, duration: 0.8, ease: 'power3.out' }, 0.6)
      .to('[data-gsap="hero-subtitle"]', { opacity: 1, y: 0, duration: 0.6, ease: 'power2.out' }, 0.8)
      .to('[data-gsap="hero-desc"]', { opacity: 1, y: 0, duration: 0.6, ease: 'power2.out' }, 1.0)
      .to('[data-gsap="hero-ctas"]', { opacity: 1, y: 0, duration: 0.6, ease: 'power2.out' }, 1.2);

    // Hero background parallax
    const heroBg = document.querySelector('[data-gsap="hero-bg"]');
    if (heroBg) {
      gsap.to(heroBg, {
        yPercent: 20,
        ease: 'none',
        scrollTrigger: {
          trigger: heroBg.closest('section'),
          start: 'top top',
          end: 'bottom top',
          scrub: true,
        },
      });
    }

    // ─── About Preview: image slides from left, text from right ─────
    gsap.set('[data-gsap="about-img"]', { opacity: 0, x: -60 });
    gsap.set('[data-gsap="about-text"]', { opacity: 0, x: 60 });

    const aboutImg = document.querySelector('[data-gsap="about-img"]');
    if (aboutImg) {
      const aboutSection = aboutImg.closest('section');
      const aboutTl = gsap.timeline({
        scrollTrigger: {
          trigger: aboutSection,
          start: 'top 80%',
          toggleActions: 'play none none none',
        },
      });
      aboutTl
        .to('[data-gsap="about-img"]', { opacity: 1, x: 0, duration: 0.8, ease: 'power2.out' })
        .to('[data-gsap="about-text"]', { opacity: 1, x: 0, duration: 0.8, ease: 'power2.out' }, '-=0.5');
    }

    // ─── Section headings: fade + slide up ──────────────────────────
    gsap.set('[data-gsap="section-head"]', { opacity: 0, y: 30 });
    document.querySelectorAll('[data-gsap="section-head"]').forEach((el) => {
      gsap.to(el, {
        opacity: 1,
        y: 0,
        duration: 0.7,
        ease: 'power2.out',
        scrollTrigger: {
          trigger: el,
          start: 'top 88%',
          toggleActions: 'play none none none',
        },
      });
    });

    // ─── Burning ideogram reveals (from StylesAnimation pattern) ──
    document.querySelectorAll('[data-gsap="ideogram"]').forEach((char) => {
      const section = char.closest('.style-section');
      const glow = section?.querySelector('[data-gsap="ideogram-glow"]');
      const content = section?.querySelector('[data-gsap="style-content"]');

      // Initial states
      gsap.set(char, {
        clipPath: 'inset(100% 0 0 0)',
        textShadow: '0 0 0px transparent',
      });
      if (glow) gsap.set(glow, { opacity: 0, scale: 0.4 });
      if (content) gsap.set(content, { opacity: 0, x: 40 });

      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: section,
          start: 'top 75%',
          toggleActions: 'play none none none',
        },
      });

      // 1. Background glow expands
      if (glow) {
        tl.to(glow, {
          opacity: 0.7,
          scale: 1,
          duration: 1.2,
          ease: 'power2.out',
        }, 0);
      }

      // 2. Character burns in — clip-path reveals top to bottom
      tl.to(char, {
        clipPath: 'inset(0% 0 0 0)',
        duration: 1.5,
        ease: 'power1.inOut',
      }, 0.1);

      // 3. Ember glow peaks during reveal
      tl.to(char, {
        textShadow: '0 0 40px rgba(196, 30, 58, 0.8), 0 0 80px rgba(139, 0, 0, 0.5), 0 0 20px rgba(212, 175, 55, 0.6)',
        duration: 0.8,
        ease: 'power2.in',
      }, 0.3);

      // 4. Ember glow settles to warm ambient
      tl.to(char, {
        textShadow: '0 0 15px rgba(212, 175, 55, 0.25), 0 0 40px rgba(212, 175, 55, 0.08)',
        duration: 1.0,
        ease: 'power2.out',
      }, 1.3);

      // 5. Background glow settles
      if (glow) {
        tl.to(glow, {
          opacity: 0.25,
          duration: 1.0,
          ease: 'power2.out',
        }, 1.3);
      }

      // 6. Content slides in from right
      if (content) {
        tl.to(content, {
          opacity: 1,
          x: 0,
          duration: 0.8,
          ease: 'power2.out',
        }, 0.6);
      }
    });

    // ─── Gallery items: fade + scale in ─────────────────────────────
    gsap.set('[data-gsap="gallery-item"]', { opacity: 0, scale: 0.9 });
    document.querySelectorAll('[data-gsap="gallery-grid"]').forEach((grid) => {
      const items = grid.querySelectorAll('[data-gsap="gallery-item"]');
      if (items.length === 0) return;
      gsap.to(items, {
        opacity: 1,
        scale: 1,
        duration: 0.6,
        ease: 'power2.out',
        stagger: 0.12,
        scrollTrigger: {
          trigger: grid,
          start: 'top 85%',
          toggleActions: 'play none none none',
        },
      });
    });

    // ─── Location cards: staggered slide up + map reveal ───────────
    const locationCards = document.querySelectorAll('[data-gsap="location-card"]');
    gsap.set(locationCards, { opacity: 0, y: 40 });
    locationCards.forEach((card, i) => {
      gsap.to(card, {
        opacity: 1,
        y: 0,
        duration: 0.7,
        ease: 'power2.out',
        delay: i * 0.25,
        scrollTrigger: {
          trigger: card,
          start: 'top 80%',
          toggleActions: 'play none none none',
        },
      });

      // Delayed map iframe reveal
      const map = card.querySelector('[data-gsap="location-map"]');
      if (map) {
        gsap.set(map, { opacity: 0 });
        gsap.to(map, {
          opacity: 1,
          duration: 0.5,
          delay: i * 0.25 + 0.3,
          scrollTrigger: {
            trigger: card,
            start: 'top 80%',
            toggleActions: 'play none none none',
          },
        });
      }
    });

    // ─── Wuxing elements: elemental glow entrance + breathing ─────
    const wuxingElements = document.querySelectorAll<HTMLElement>('[data-gsap="wuxing-element"]');
    gsap.set(wuxingElements, { opacity: 0, y: 20 });
    const wuxingSection = document.querySelector('[data-gsap="wuxing-section"]');
    if (wuxingSection && wuxingElements.length) {
      const wuxingTl = gsap.timeline({
        scrollTrigger: {
          trigger: wuxingSection,
          start: 'top 85%',
          toggleActions: 'play none none none',
        },
      });

      wuxingElements.forEach((el, i) => {
        const circle = el.querySelector('[data-wuxing-circle]');
        const char = el.querySelector('.font-chinese');
        const color = el.dataset.wuxingColor || '#fff';
        const offset = i * 0.18;

        // 1. Element entrance — fade + slide up
        wuxingTl.to(el, {
          opacity: 1,
          y: 0,
          duration: 0.5,
          ease: 'back.out(1.7)',
        }, offset);

        // 2. Circle glow burst
        if (circle) {
          wuxingTl.to(circle, {
            boxShadow: `0 0 20px ${color}66, 0 0 40px ${color}33, inset 0 0 12px ${color}22`,
            duration: 0.6,
            ease: 'power2.out',
          }, offset + 0.2);

          // Settle to subtle resting glow
          wuxingTl.to(circle, {
            boxShadow: `0 0 6px ${color}20, 0 0 15px ${color}10, inset 0 0 6px ${color}08`,
            duration: 0.8,
            ease: 'power2.out',
          }, offset + 0.8);
        }

        // 3. Character text-shadow glow
        if (char) {
          wuxingTl.to(char, {
            textShadow: `0 0 15px ${color}99, 0 0 35px ${color}44`,
            duration: 0.5,
            ease: 'power2.out',
          }, offset + 0.25);

          wuxingTl.to(char, {
            textShadow: `0 0 6px ${color}30, 0 0 15px ${color}15`,
            duration: 0.8,
            ease: 'power2.out',
          }, offset + 0.75);
        }
      });

      // 4. Continuous breathing glow after entrance completes
      wuxingTl.call(() => {
        wuxingElements.forEach((el) => {
          const circle = el.querySelector('[data-wuxing-circle]');
          const char = el.querySelector('.font-chinese');
          const color = el.dataset.wuxingColor || '#fff';

          if (circle) {
            gsap.to(circle, {
              boxShadow: `0 0 12px ${color}30, 0 0 25px ${color}18, inset 0 0 10px ${color}12`,
              duration: 2 + Math.random() * 0.8,
              ease: 'sine.inOut',
              repeat: -1,
              yoyo: true,
            });
          }
          if (char) {
            gsap.to(char, {
              textShadow: `0 0 10px ${color}50, 0 0 22px ${color}25`,
              duration: 2.2 + Math.random() * 0.8,
              ease: 'sine.inOut',
              repeat: -1,
              yoyo: true,
            });
          }
        });
      });
    }

    // ─── CTA section: simple fade in ────────────────────────────────
    const ctaSection = document.querySelector('[data-gsap="cta-section"]');
    if (ctaSection) {
      const ctaInner = ctaSection.querySelector(':scope > div');
      if (ctaInner) {
        gsap.set(ctaInner.children, { opacity: 0, y: 20 });
        gsap.to(ctaInner.children, {
          opacity: 1,
          y: 0,
          duration: 0.6,
          ease: 'power2.out',
          stagger: 0.12,
          scrollTrigger: {
            trigger: ctaSection,
            start: 'top 85%',
            toggleActions: 'play none none none',
          },
        });
      }
    }
</script>
